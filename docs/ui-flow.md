# Chrome拡張機能「動画音声文字起こしツール」UIフロー図

## 📱 概要
本文書では、Chrome拡張機能「動画音声文字起こしツール」のユーザーインターフェースの流れと画面遷移を図解し、ユーザーエクスペリエンスを明確化します。

## 🎯 全体UIフロー図

```mermaid
graph TD
    A[Chrome ツールバー] --> B[拡張機能アイコン]
    B --> C{初回起動?}
    C -->|Yes| D[初期設定画面]
    C -->|No| E[メインポップアップ]
    D --> F[Google Drive認証]
    F --> G[APIキー設定]
    G --> H[基本設定]
    H --> E
    E --> I{録音状態?}
    I -->|停止中| J[録音開始ボタン]
    I -->|録音中| K[録音停止ボタン]
    J --> L[録音中UI]
    K --> M[処理中UI]
    M --> N[完了通知]
    N --> E
    E --> O[設定ボタン]
    O --> P[設定画面]
    P --> E
```

## 🖥️ 詳細画面フロー

### 1. 初回起動・設定フロー

```mermaid
sequenceDiagram
    participant User as ユーザー
    participant Icon as 拡張機能アイコン
    participant Welcome as ウェルカム画面
    participant Auth as 認証画面
    participant Settings as 設定画面
    participant Main as メイン画面
    
    User->>Icon: アイコンクリック（初回）
    Icon->>Welcome: ウェルカム画面表示
    Welcome->>User: 設定開始案内
    User->>Welcome: "設定を開始" ボタン
    Welcome->>Auth: Google Drive認証画面
    Auth->>User: 認証要求
    User->>Auth: Google アカウント認証    Auth->>Settings: 基本設定画面
    Settings->>User: エンジン選択・APIキー・言語設定
    
    alt Web Speech API選択
        Settings->>User: APIキー入力スキップ
        User->>Settings: エンジン・言語設定のみ保存
    else 外部API選択
        User->>Settings: 全設定入力・保存
    end
    
    Settings->>Main: メイン画面へ
    Main->>User: 録音可能状態表示
```

### 2. メイン録音フロー

```mermaid
sequenceDiagram
    participant User as ユーザー
    participant Main as メイン画面
    participant Recording as 録音中画面
    participant Processing as 処理中画面
    participant Complete as 完了画面
    
    User->>Main: アイコンクリック
    Main->>User: メイン画面表示
    User->>Main: "録音開始" ボタン
    Main->>Recording: 録音中画面に切り替え    Recording->>User: 録音状態・進捗表示
    
    Note over Recording: リアルタイム文字起こし表示<br/>(Web Speech API: 連続処理<br/>外部API: 定期更新)
    
    User->>Recording: "録音停止" ボタン
    Recording->>Processing: 処理中画面に切り替え
    Processing->>User: 処理進捗表示
    Processing->>Complete: 完了画面に切り替え
    Complete->>User: 完了通知・結果表示
    Complete->>Main: メイン画面に戻る
```

### 3. 設定管理フロー

```mermaid
sequenceDiagram
    participant User as ユーザー
    participant Main as メイン画面
    participant Settings as 設定画面
    participant API as API設定
    participant Drive as Drive設定
    
    User->>Main: "設定" ボタン
    Main->>Settings: 設定画面表示
    Settings->>User: 設定カテゴリ表示
      alt APIキー設定
        User->>Settings: "API設定" タブ
        Settings->>API: API設定画面
        API->>User: エンジン選択・キー入力
        
        alt Web Speech API選択
            API->>User: "APIキー不要" 表示
            User->>API: エンジン選択のみ保存
        else 外部API選択
            User->>API: APIキー入力・保存
        end
        
        User->>API: 設定保存
        API->>Settings: 設定完了
    else Google Drive設定
        User->>Settings: "Drive設定" タブ
        Settings->>Drive: Drive設定画面
        Drive->>User: フォルダ選択・認証
        User->>Drive: 設定保存
        Drive->>Settings: 設定完了
    end
    
    Settings->>Main: メイン画面に戻る
```

## 📋 画面詳細設計

### 1. メインポップアップ画面

```
┌─────────────────────────────────┐
│ 🎙️ 動画音声文字起こしツール      │
├─────────────────────────────────┤
│                                 │
│  📹 現在のタブ: YouTube動画     │
│  🎯 状態: 準備完了              │
│  🤖 エンジン: Web Speech API    │
│                                 │
│  ┌─────────────────────────┐    │
│  │    🔴 録音開始             │    │
│  └─────────────────────────┘    │
│                                 │
│  ⚙️ 設定    📋 履歴    ❓ ヘルプ │
│                                 │
└─────────────────────────────────┘
```

### 2. 録音中画面

```
┌─────────────────────────────────┐
│ 🎙️ 録音中...                   │
├─────────────────────────────────┤
│                                 │
│  🔴 録音時間: 00:05:23          │
│  📊 音声レベル: ████████░░      │
│  🤖 エンジン: Web Speech API    │
│                                 │
│  📝 リアルタイム文字起こし:     │
│  ┌─────────────────────────┐    │
│  │今日は素晴らしい天気です...  │    │
│  │AIの技術について説明して...  │    │
│  │（連続文字起こし中...）     │    │
│  └─────────────────────────┘    │
│                                 │
│  ┌─────────────────────────┐    │
│  │    ⏹️ 録音停止             │    │
│  └─────────────────────────┘    │
│                                 │
└─────────────────────────────────┘
```

### 3. 処理中画面

```
┌─────────────────────────────────┐
│ ⏳ 処理中...                   │
├─────────────────────────────────┤
│                                 │
│  📊 進捗: ██████████░░ 80%     │
│                                 │
│  📝 最終処理中...               │
│  💾 Google Driveに保存中...    │
│                                 │
│  ⚠️ この画面を閉じないで         │
│     ください                   │
│                                 │
└─────────────────────────────────┘
```

### 4. 完了画面

```
┌─────────────────────────────────┐
│ ✅ 完了！                      │
├─────────────────────────────────┤
│                                 │
│  📄 ファイル名:                 │
│  2025-06-03_14-30-15_YouTube    │
│  _講義動画_transcript.txt       │
│                                 │
│  📁 保存先: Google Drive        │
│  📊 録音時間: 00:15:42          │
│  🤖 エンジン: Web Speech API    │
│  🌐 言語: 日本語               │
│                                 │
│  ┌─────────────────────────┐    │
│  │    📂 ファイルを開く        │    │
│  └─────────────────────────┘    │
│  ┌─────────────────────────┐    │
│  │    🔄 新しい録音を開始      │    │
│  └─────────────────────────┘    │
│                                 │
└─────────────────────────────────┘
```

### 5. 設定画面（Options Page）

```
┌─────────────────────────────────────────────────────┐
│ ⚙️ 設定                                            │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 📑 [基本設定] [API設定] [Google Drive] [詳細設定]   │
│                                                     │
│ 🎯 基本設定                                         │
│ ┌─────────────────────────────────────────────────┐ │
│ │ 🌐 デフォルト言語: [日本語 ▼]                   │ │
│ │ 🎚️ 音声品質: [高品質 ▼]                        │ │
│ │ 🔔 通知設定: [✓] 完了時に通知                   │ │
│ │ 💾 自動保存: [✓] 録音停止時に自動保存           │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ 🤖 文字起こしエンジン                               │
│ ┌─────────────────────────────────────────────────┐ │
│ │ ◉ Google Speech-to-Text (高精度・有料)         │ │
│ │ ○ Web Speech API (標準・無料・中程度精度)      │ │
│ │ ○ OpenAI Whisper (高精度・有料)                │ │
│ │                                                 │ │
│ │ 🔑 APIキー: [********************] [テスト]     │ │
│ │ ℹ️ Web Speech API選択時はAPIキー不要            │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ ☁️ Google Drive設定                                │
│ ┌─────────────────────────────────────────────────┐ │
│ │ 🔐 認証状態: ✅ 接続済み                        │ │
│ │ 📁 保存フォルダ: /転写ファイル                   │ │
│ │ 🔄 [再認証] [フォルダ変更]                      │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ ┌─────────────────────────┐ ┌─────────────────────┐ │
│ │         💾 保存         │ │      🔄 リセット    │ │
│ └─────────────────────────┘ └─────────────────────┘ │
│                                                     │
└─────────────────────────────────────────────────────┘
```

## 🎨 UIコンポーネント設計

### 1. ステータス表示

#### 録音状態インジケーター
```mermaid
stateDiagram-v2
    [*] --> 準備完了
    準備完了 --> 録音中: 録音開始
    録音中 --> 処理中: 録音停止
    処理中 --> 完了: 処理完了
    完了 --> 準備完了: 新しい録音
    
    準備完了: 🟢 準備完了
    録音中: 🔴 録音中
    処理中: 🟡 処理中
    完了: ✅ 完了
```

#### 音声レベルメーター
```
音声レベル: ████████░░ (80%)
             ┌─────────┐
低音量 ──────┤ ████████ ├────── 高音量
             └─────────┘
```

### 2. ボタン設計

#### プライマリボタン（録音制御）
```
┌─────────────────────────┐
│    🔴 録音開始          │  ← 停止中
└─────────────────────────┘

┌─────────────────────────┐
│    ⏹️ 録音停止          │  ← 録音中
└─────────────────────────┘
```

#### セカンダリボタン
```
⚙️ 設定    📋 履歴    ❓ ヘルプ
```

### 3. 進捗表示

#### 処理進捗バー
```
📊 進捗: ██████████░░ 80%
        
段階別表示:
🎙️ 音声処理中...     (0-30%)
🤖 文字起こし中...   (30-80%)
💾 保存中...         (80-100%)

※Web Speech API使用時：
リアルタイム処理のため進捗表示は簡略化
🎙️ 最終処理中...
💾 Google Driveに保存中...
```

## 📱 レスポンシブ対応

### 1. ポップアップサイズ
```
標準サイズ: 320px × 480px
最小サイズ: 280px × 400px
最大サイズ: 400px × 600px
```

### 2. 設定画面サイズ
```
標準サイズ: 800px × 600px
最小サイズ: 600px × 500px
```

## 🔄 画面遷移ルール

### 1. 遷移条件
```mermaid
flowchart TD
    A[アイコンクリック] --> B{設定済み？}
    B -->|Yes| C[メイン画面]
    B -->|No| D[初期設定]
    C --> E{アクティブタブ対応？}
    E -->|Yes| F[録音可能状態]
    E -->|No| G[未対応サイト通知]
    F --> H[録音開始可能]
```

### 2. エラー時の画面遷移
```mermaid
flowchart TD
    A[エラー発生] --> B{エラータイプ}
    B -->|ネットワーク| C[接続エラー画面]
    B -->|認証| D[認証エラー画面]
    B -->|API制限| E[制限エラー画面]
    B -->|Web Speech未対応| F[ブラウザ対応エラー画面]
    B -->|マイクアクセス拒否| G[権限エラー画面]
    B -->|その他| H[汎用エラー画面]
    
    C --> I[リトライボタン]
    D --> J[再認証ボタン]
    E --> K[制限解除待ち]
    F --> L[Chrome推奨案内]
    G --> M[権限設定案内]
    H --> N[サポート案内]
```

## 🎯 ユーザビリティ設計

### 1. 操作の簡素化
- **ワンクリック録音**: メイン機能を最大ボタンで配置
- **状態の明確化**: 色とアイコンで直感的に状態表示
- **エラーの分かりやすさ**: 平易な言葉でエラー内容を説明

### 2. アクセシビリティ
- **キーボード操作**: 全ての操作をキーボードで実行可能
- **コントラスト**: WCAG 2.1 AA準拠の色彩設計
- **フォントサイズ**: 最小14px、重要な情報は16px以上

### 3. フィードバック設計
```mermaid
flowchart LR
    A[ユーザー操作] --> B[即座の視覚フィードバック]
    B --> C[処理状況の表示]
    C --> D[完了・エラー通知]
    D --> E[次の行動の案内]
```

## 📊 画面パフォーマンス

### 1. 描画速度
- **初期表示**: 100ms以内
- **画面遷移**: 200ms以内
- **データ更新**: 50ms以内

### 2. メモリ使用量
- **ポップアップ**: 最大10MB
- **設定画面**: 最大15MB
- **バックグラウンド処理**: UI影響なし

## 🎤 Web Speech API特有のUI考慮事項

### 1. エンジン選択時の表示制御
- **APIキー入力欄**: Web Speech API選択時は非表示
- **費用警告**: 「無料」表示でユーザーに安心感を提供
- **精度表示**: 「中程度の精度」として期待値を適切に設定

### 2. リアルタイム処理の UI表現
- **連続文字起こし**: 文字が流れるような表示効果
- **中間結果表示**: グレーアウト文字で暫定結果を表示
- **確定結果**: 通常文字色で最終結果を表示

### 3. ネットワーク依存の通知
- **接続状態**: Web Speech APIはオンライン必須のため接続状態を監視
- **エラーハンドリング**: ネットワーク断時の適切なフォールバック表示

### 4. ブラウザ互換性の配慮
- **対応ブラウザ**: Chrome系ブラウザでのみ利用可能であることを明示
- **代替案提示**: 非対応時は他のエンジンへの切り替えを案内

## 🔔 通知システム

### 1. Chrome通知
```
┌─────────────────────────────────┐
│ 🎙️ 動画音声文字起こしツール     │
│                                 │
│ ✅ 文字起こしが完了しました     │
│ 📄 YouTube_講義動画.txt         │
│ 🤖 Web Speech API使用          │
│ 💾 Google Driveに保存済み       │
│                                 │
│ [開く] [閉じる]                 │
└─────────────────────────────────┘
```

### 2. インライン通知
```
┌─────────────────────────────────┐
│ ⚠️ 注意: マイクアクセスが        │
│    必要です                     │
│ [許可する] [後で]               │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ ℹ️ Web Speech API選択中         │
│    ネットワーク接続が必要です   │
│ [了解]                          │
└─────────────────────────────────┘

┌─────────────────────────────────┐
│ ⚠️ このブラウザはWeb Speech API │
│    に対応していません           │
│ [設定変更] [閉じる]             │
└─────────────────────────────────┘
```

---

**UIフロー図作成日**: 2025年6月3日
**最終更新日**: 2025年6月3日（Web Speech API対応追加）
**作成者**: UI/UX設計チーム
**承認者**: [承認者名]

### 更新履歴
- **2025年6月3日**: Web Speech API対応のUI要素追加
  - 設定画面でのエンジン選択オプション追加
  - APIキー不要の表示制御
  - リアルタイム処理UI表現の改善
  - エラーハンドリングの拡張
  - 通知システムのエンジン情報表示

### 関連文書
- [要件定義書](requirement.md)
- [データフロー図](data-flow.md)
- [開発チェックリスト](checklist.md)
- [デザインガイドライン](design-guidelines.md)
